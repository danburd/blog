{{/* https://discourse.gohugo.io/t/simple-image-render-hook-template-for-responsive-images/22464 */}}
{{ $image := .Page.Resources.GetMatch (printf "%s" (.Destination | safeURL)) }}
{{ if $image }}
  {{ $small := $image.Resize "720x webp" }}
  {{ $alt := .PlainText | safeHTML }}
  {{ $caption := "" }}
  {{ with .Title }}
    {{ $caption = . | safeHTML }}
  {{ end }}

  <a href="{{ $image.RelPermalink }}">
    <img
      src="{{ $small.RelPermalink }}"
      width="{{ $small.Width }}"
      height="{{ $small.Height }}"
      alt="{{ if $alt }}{{ $alt }}{{ else if $caption }}{{ $caption | markdownify | plainify }}{{ else }}{{ end }}"
      >
  </a>
  {{ with $caption }}
  <br>{{ . | markdownify }}
  {{ end }}
{{ end }}

{{/* 

  Original code from: https://www.bennettnotes.com/notes/hugo-responsive-images-with-markdown-render-hook/

  {{ $src := .Page.Resources.GetMatch (printf "%s" (.Destination | safeURL))  }}
  {{ $alt := .PlainText | safeHTML }}
  
  {{ if $src }}
  
  {{ $tinyw := default "360x webp" }}
  {{ $data := newScratch }}
  {{ $data.Set "tiny" ($src.Resize $tinyw) }}
  {{ $tiny := $data.Get "tiny" }}
  
  <a href="{{ $src.RelPermalink }}">
      <img src="{{with $tiny.RelPermalink }}{{.}}{{ end }}" alt="{{ $alt }}" title="{{ $alt }}" height="{{ $tiny.Height}}" width="{{ $tiny.Width }}" class="img-fluid">
  </a>
    {{ end }}

*/}}